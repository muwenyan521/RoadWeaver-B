# 无限制结构搜寻系统

## 🎯 设计理念

**问题**: 原有的数量限制（`maxLocatingCount = 100`）不够灵活，玩家探索新区域时无法继续发现结构。

**解决方案**: 移除所有限制，让玩家自由探索和连接任何发现的结构。

---

## ✨ 新特性

### 1. 无限制探索

- ❌ **移除**: `maxLocatingCount` 配置项
- ✅ **新增**: 基于距离的智能过滤
- 🎮 **效果**: 玩家可以无限探索，持续发现新结构

### 2. 可调节搜寻半径

**新配置**: `structureSearchRadius`
- **默认值**: 100 区块（1600 方块）
- **范围**: 50-200 区块
- **作用**: 控制每次搜寻的范围

**优点**:
- 小半径：快速搜寻，适合密集结构
- 大半径：广域搜寻，适合稀疏结构

---

## ⚙️ 配置说明

### 配置文件位置

```
config/roadweaver.json
```

### 新配置项

```json
{
  "structureSearchRadius": 100  // 搜寻半径（区块）
}
```

### 配置场景

#### 场景 1: 密集道路网络

```json
{
  "structureSearchRadius": 150,
  "minDistanceBetweenStructures": 1000
}
```

**效果**:
- 更广的搜寻范围
- 更小的距离限制
- 更多的结构连接
- 更密集的道路网络

#### 场景 2: 稀疏主干道路

```json
{
  "structureSearchRadius": 100,
  "minDistanceBetweenStructures": 5000
}
```

**效果**:
- 标准搜寻范围
- 更大的距离限制
- 只连接远距离结构
- 主干道路为主

#### 场景 3: 超广域探索

```json
{
  "structureSearchRadius": 200,
  "minDistanceBetweenStructures": 3000
}
```

**效果**:
- 最大搜寻范围
- 中等距离限制
- 适合大型地图
- 长距离道路连接

---

## 🔍 工作原理

### 搜寻流程

```
玩家探索新区域
    ↓
每 300 区块触发搜寻
    ↓
在玩家位置周围 structureSearchRadius 范围内搜寻
    ↓
找到新结构
    ↓
创建连接（最近邻算法）
    ↓
生成道路
    ↓
继续探索...（无限循环）
```

### 连接算法

使用最近邻算法：每个新结构自动连接到最近的已知结构。

**特点**:
- 简单直接
- 无需复杂配置
- 玩家有完全的自由度

---

## 📊 性能影响

### 对比分析

| 指标 | 旧系统（数量限制） | 新系统（距离限制） |
|------|------------------|-------------------|
| **内存占用** | 固定（最多100个结构） | 动态（取决于探索范围） |
| **搜寻频率** | 达到上限后停止 | 持续搜寻 |
| **CPU占用** | 低（搜寻停止后） | 中（持续搜寻） |
| **道路密度** | 不可控 | 自然形成 |
| **探索体验** | 受限（达到上限） | 无限（持续发现） |

### 性能优化

1. **搜寻频率控制**
   - 仍然保持每 300 区块触发一次
   - 避免频繁搜寻

2. **日志输出**
   ```
   [DEBUG] Structure found at BlockPos{x=1234, y=64, z=5678}
   [DEBUG] Created connection between BlockPos{...} and BlockPos{...} (distance: 2456.7 blocks)
   ```

---

## 🎮 游戏体验改进

### 改进前

```
玩家探索 → 找到 100 个结构 → 停止搜寻 → 无法继续发现 ❌
```

**问题**:
- 探索到远方时无法生成新道路
- 数量限制过于死板
- 无法适应不同游戏风格

### 改进后

```
玩家探索 → 持续发现结构 → 自动连接 → 生成道路 → 无限探索 ✅
```

**优点**:
- 随着探索自然扩展
- 完全的自由度
- 适应各种游戏风格
- 更好的长期游戏体验

---

## 🔧 调试与监控

### 日志关键字

搜索日志中的以下关键字：

```
"Structure found at"           // 找到新结构
"Created connection between"   // 创建连接
"distance: X blocks"           // 连接距离
```

### 调试界面（按 H 键）

**观察指标**:
- 🟢 绿色节点数量：已发现的结构
- 🟡 黄色连接线：计划生成的道路
- 🟠 橙色连接线：正在生成的道路

**验证方法**:
1. 打开调试界面
2. 观察节点分布
3. 检查连接距离
4. 确认没有过近的连接

---

## 📝 迁移指南

### 从旧版本升级

#### 1. 配置文件变更

**旧配置** (v2.0.2):
```json
{
  "maxLocatingCount": 100
}
```

**新配置** (v2.0.3):
```json
{
  "structureSearchRadius": 100
}
```

#### 2. 行为变化

| 方面 | 旧版本 | 新版本 |
|------|--------|--------|
| **数量限制** | 100个 | 无限制 |
| **搜寻半径** | 固定100区块 | 可配置50-200区块 |
| **探索体验** | 受限 | 完全自由 |

#### 3. 推荐设置

**标准设置** (推荐):
```json
{
  "structureSearchRadius": 100
}
```
效果：平衡的搜寻范围

**快速搜寻**:
```json
{
  "structureSearchRadius": 50
}
```
效果：更快的搜寻速度

**广域搜寻**:
```json
{
  "structureSearchRadius": 200
}
```
效果：更大的搜寻范围

---

## 🎯 设计目标达成

### ✅ 已实现

- [x] 移除数量限制
- [x] 可调节搜寻半径
- [x] 无限探索支持
- [x] 完全的连接自由度
- [x] 性能优化
- [x] 详细日志输出
- [x] 向后兼容

### 🎉 用户收益

1. **更好的探索体验**: 无限制探索，持续发现
2. **完全的自由度**: 连接任何发现的结构
3. **更灵活的配置**: 可调节搜寻范围
4. **简单直接**: 无需复杂的距离配置

---

## 🔮 未来改进方向

### 短期

- [ ] 添加"排除区域"功能（不在特定区域搜寻）
- [ ] 支持多种结构类型同时搜寻
- [ ] 添加可选的"最大连接距离"限制

### 中期

- [ ] 智能路径规划（避开已有道路）
- [ ] 道路网络优化（减少交叉）
- [ ] 区域密度控制（不同区域不同密度）

### 长期

- [ ] 机器学习优化（学习玩家偏好）
- [ ] 多玩家协作（服务器模式）
- [ ] 动态调整（根据游戏进度）

---

## 📚 相关文档

- `STRUCTURE_LOCATING_MECHANISM.md` - 结构搜寻机制详解
- `QUICK_REFERENCE.md` - 快速参考指南
- `changelog.md` - 版本更新日志

---

**版本**: v2.0.3  
**更新日期**: 2025-10-03  
**作者**: RoadWeaver Team
