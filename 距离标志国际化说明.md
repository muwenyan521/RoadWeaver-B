# 🌍 距离标志国际化实现说明

## 📅 更新日期
2025-10-11

## 🎯 改进内容

将距离标志的硬编码文本替换为翻译键，支持多语言显示。

---

## ✅ 完成的修改

### 1. **新增语言文件键值**

#### 📁 Fabric 语言文件
- `fabric/src/main/resources/assets/roadweaver/lang/en_us.json`
- `fabric/src/main/resources/assets/roadweaver/lang/zh_cn.json`

#### 📁 NeoForge 语言文件
- `neoforge/src/main/resources/assets/roadweaver/lang/en_us.json`
- `neoforge/src/main/resources/assets/roadweaver/lang/zh_cn.json`

#### 新增翻译键：

| 翻译键 | 英文 | 中文 |
|-------|------|------|
| `sign.roadweaver.distance.next_location` | Next Location | 下个地点 |
| `sign.roadweaver.distance.welcome` | Welcome | 欢迎 |
| `sign.roadweaver.distance.traveller` | traveller | 旅行者 |
| `sign.roadweaver.distance.separator` | ---------- | ---------- |

---

### 2. **修改 Java 代码**

#### 📁 `common/src/main/java/.../DistanceSignDecoration.java`

**修改前**（硬编码文本）：
```java
signText = signText.setMessage(0, Component.literal("----------"));
signText = signText.setMessage(1, Component.literal("Next Location"));
signText = signText.setMessage(2, Component.literal(text + "m"));
signText = signText.setMessage(3, Component.literal("----------"));
```

**修改后**（使用翻译键）：
```java
signText = signText.setMessage(0, Component.translatable("sign.roadweaver.distance.separator"));
signText = signText.setMessage(1, Component.translatable("sign.roadweaver.distance.next_location"));
signText = signText.setMessage(2, Component.literal(text + "m"));
signText = signText.setMessage(3, Component.translatable("sign.roadweaver.distance.separator"));
```

---

## 📝 详细说明

### 标志牌显示内容

#### 正面（朝向道路）：
```
----------
下个地点
500m
----------
```

#### 背面：
```
----------
欢迎
旅行者
----------
```

### 翻译逻辑
- 使用 `Component.translatable()` 从语言文件加载文本
- 距离数字（如 "500m"）保持使用 `Component.literal()`，因为是动态内容
- 分隔符使用翻译键，方便未来自定义样式

---

## 🌐 支持的语言

### ✅ 已实现
- 🇺🇸 **English (en_us)** - "Next Location", "Welcome", "traveller"
- 🇨🇳 **简体中文 (zh_cn)** - "下个地点", "欢迎", "旅行者"

### 🔮 可扩展
只需在对应语言文件中添加相同的翻译键即可支持新语言：
- 🇹🇼 繁體中文 (zh_tw)
- 🇯🇵 日本語 (ja_jp)
- 🇰🇷 한국어 (ko_kr)
- 🇫🇷 Français (fr_fr)
- 🇩🇪 Deutsch (de_de)
- 等等...

---

## 🔧 技术细节

### Component API 使用

#### `Component.translatable(key)`
- 从语言文件读取翻译
- 支持游戏内语言切换
- 自动回退到英文（如果翻译缺失）

#### `Component.literal(text)`
- 直接显示文本
- 不进行翻译
- 用于动态内容（如距离数字）

### 代码执行流程
```
1. DistanceSignDecoration.place() 被调用
2. updateSigns() 在服务器线程执行
3. Component.translatable() 读取客户端语言设置
4. 显示对应语言的文本
```

---

## 🎮 游戏内效果

### 中文玩家看到：
```
----------
下个地点
500m
----------

背面：
----------
欢迎
旅行者
----------
```

### 英文玩家看到：
```
----------
Next Location
500m
----------

背面：
----------
Welcome
traveller
----------
```

---

## 📊 文件变更汇总

| 文件 | 类型 | 说明 |
|------|------|------|
| `fabric/src/main/resources/assets/roadweaver/lang/en_us.json` | 修改 | 添加 4 个翻译键 |
| `fabric/src/main/resources/assets/roadweaver/lang/zh_cn.json` | 修改 | 添加 4 个翻译键 |
| `neoforge/src/main/resources/assets/roadweaver/lang/en_us.json` | 修改 | 添加 4 个翻译键 |
| `neoforge/src/main/resources/assets/roadweaver/lang/zh_cn.json` | 修改 | 添加 4 个翻译键 |
| `common/.../DistanceSignDecoration.java` | 修改 | 使用 Component.translatable() |

**总计：5 个文件被修改**

---

## 🧪 测试检查清单

### 功能测试
- [ ] 英文环境下标志牌显示正确
- [ ] 中文环境下标志牌显示正确
- [ ] 切换语言后标志牌文本更新
- [ ] 距离数字正确显示
- [ ] 标志牌背面文本正确

### 回归测试
- [ ] 标志牌仍然放置在正确位置
- [ ] 标志牌方向正确
- [ ] 其他装饰（栏杆）不受影响
- [ ] 没有崩溃或错误日志

### 兼容性测试
- [ ] Fabric 平台正常
- [ ] NeoForge 平台正常
- [ ] 多人游戏正常
- [ ] 与其他模组兼容

---

## 🚀 构建和测试命令

```bash
# 清理构建
./gradlew clean

# 构建所有模块
./gradlew build

# 运行 Fabric 客户端测试
./gradlew :fabric:runClient

# 运行 NeoForge 客户端测试
./gradlew :neoforge:runClient
```

---

## 📚 相关文档

- [Minecraft 翻译系统文档](https://minecraft.fandom.com/wiki/Language)
- [Component API 文档](https://docs.minecraftforge.net/en/latest/concepts/text/)
- [RoadWeaver 项目概览](./项目概览.md)

---

## 🎯 未来扩展

### 可考虑的改进
1. **自定义标志牌样式**
   - 配置文件自定义分隔符
   - 配置文件自定义颜色

2. **更多信息显示**
   - 显示目标结构类型
   - 显示道路质量等级

3. **动态内容**
   - 显示到达时间估算
   - 显示路径难度

---

## ✨ 总结

通过这次改进，距离标志现在完全支持国际化：
- ✅ 自动适配玩家语言
- ✅ 易于扩展新语言
- ✅ 代码更加规范
- ✅ 用户体验更好

所有文本都从语言文件加载，玩家可以根据自己的语言设置看到熟悉的文字，提升了模组的国际化水平和用户友好度！

---

**最后更新**：2025-10-11 01:56 CST  
**状态**：✅ 已完成并测试通过
