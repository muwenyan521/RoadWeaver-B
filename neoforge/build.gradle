plugins {
	id 'net.neoforged.moddev' version '2.0.28-beta'
	id 'maven-publish'
}

base {
	archivesName = "${rootProject.name}-neoforge"
}

// NeoForge 配置
neoForge {
	// NeoForge 版本 - 1.21.1
	version = "21.1.169"
	
	// 验证访问转换器
	validateAccessTransformers = true
	
	// 运行配置
	runs {
		client {
			client()
		}
		
		server {
			server()
		}
		
		data {
			data()
		}
	}
	
	// 模组配置
	mods {
		roadweaver {
			sourceSet sourceSets.main
		}
	}
}

// 添加生成的资源到主资源集
sourceSets.main.resources { srcDir 'src/generated/resources' }

repositories {
	maven { 
		url "https://maven.shedaniel.me/" 
		name "Shedaniel Maven"
	}
}

dependencies {
	// Cloth Config API for NeoForge
	implementation "me.shedaniel.cloth:cloth-config-neoforge:15.0.140"
}

// 处理资源文件
tasks.named('processResources', ProcessResources).configure {
	var replaceProperties = [
		minecraft_version: '1.21.1',
		minecraft_version_range: '[1.21.1,1.22)',
		neoforge_version: '21.1',
		neoforge_version_range: '[21.1,22)',
		loader_version_range: '[4,)',
		mod_id: 'settlementroads',
		mod_name: 'RoadWeaver',
		mod_version: project.version,
		mod_authors: 'Countered',
		mod_description: 'Automatically generates roads between structures'
	]
	
	inputs.properties replaceProperties
	
	filesMatching(['META-INF/neoforge.mods.toml']) {
		expand replaceProperties
	}
}

jar {
	from("${rootProject.projectDir}/LICENSE") {
		rename { "${it}_${base.archivesName.get()}"}
	}
	
	manifest {
		attributes([
			'Specification-Title'     : 'RoadWeaver',
			'Specification-Vendor'    : 'Countered',
			'Specification-Version'   : '1',
			'Implementation-Title'    : project.name,
			'Implementation-Version'  : project.version,
			'Implementation-Vendor'   : 'Countered',
			'Implementation-Timestamp': new Date().format("yyyy-MM-dd'T'HH:mm:ssZ")
		])
	}
}

// Maven 发布
publishing {
	publications {
		create("mavenJava", MavenPublication) {
			artifactId = "${rootProject.name}-neoforge"
			from components.java
		}
	}
	repositories {
		// 添加发布仓库
	}
}
