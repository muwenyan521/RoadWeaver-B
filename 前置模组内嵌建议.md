# RoadWeaver 前置模组内嵌建议

## 📊 当前依赖分析

### Fabric 平台
```
RoadWeaver (Fabric)
├── Fabric API ⚠️ 必需 - 不可内嵌
├── Architectury API ⚠️ 必需 - 可内嵌
├── Cloth Config API ⚠️ 必需 - 可内嵌
└── Mod Menu ⭐ 推荐 - 不建议内嵌
```

### NeoForge 平台
```
RoadWeaver (NeoForge)
├── Architectury API ⚠️ 必需 - 可内嵌
└── Cloth Config API ⭐ 推荐 - 可内嵌
```

---

## ✅ 推荐内嵌方案

### 🎯 方案 1：内嵌 Architectury API（推荐）

**优点**:
- ✅ 减少 1 个必需前置下载
- ✅ 两个平台都需要，内嵌后统一体验
- ✅ 文件较小（~500KB）
- ✅ 玩家最常缺少的依赖之一
- ✅ 不会与其他模组冲突（使用 JiJ 技术）

**缺点**:
- ⚠️ 增加模组文件大小约 500KB
- ⚠️ 如果玩家已安装 Architectury，会有轻微冗余

**影响**:
- Fabric: 前置从 4 个减少到 3 个
- NeoForge: 前置从 2 个减少到 1 个

---

### 🎯 方案 2：内嵌 Cloth Config API

**优点**:
- ✅ 减少 1 个前置下载
- ✅ 配置界面开箱即用
- ✅ 文件较小（~1MB）

**缺点**:
- ⚠️ Cloth Config 更新频繁，内嵌版本可能过时
- ⚠️ 很多模组都需要 Cloth Config，玩家通常已安装
- ⚠️ NeoForge 平台 Cloth Config 是可选的，内嵌会强制包含

**不推荐原因**:
- Cloth Config 是通用配置库，很多模组都依赖
- 玩家通常已经安装，内嵌反而造成冗余
- 更新频繁，内嵌版本容易过时

---

### 🎯 方案 3：同时内嵌 Architectury + Cloth Config

**优点**:
- ✅ Fabric: 前置从 4 个减少到 2 个（仅需 Fabric API + Mod Menu）
- ✅ NeoForge: 前置从 2 个减少到 0 个（完全独立）
- ✅ 开箱即用，用户体验最佳

**缺点**:
- ⚠️ 增加模组文件大小约 1.5MB
- ⚠️ 如果玩家已安装这些模组，会有冗余
- ⚠️ Cloth Config 更新时需要重新发布

---

## 🎯 最终推荐：仅内嵌 Architectury API

### 理由

1. **必需性**: Architectury 是两个平台的必需依赖
2. **文件大小**: 仅约 500KB，影响很小
3. **用户体验**: 玩家最常忘记下载的依赖
4. **维护成本**: Architectury 更新较少，维护简单
5. **兼容性**: 不会与其他模组冲突

### 实现后的效果

#### Fabric 平台
**之前**:
```
需要下载 4 个前置:
1. Fabric API ⚠️
2. Architectury API ⚠️
3. Cloth Config API ⚠️
4. Mod Menu ⭐
```

**之后**:
```
需要下载 3 个前置:
1. Fabric API ⚠️
2. Cloth Config API ⚠️
3. Mod Menu ⭐
```

#### NeoForge 平台
**之前**:
```
需要下载 2 个前置:
1. Architectury API ⚠️
2. Cloth Config API ⭐
```

**之后**:
```
需要下载 1 个前置:
1. Cloth Config API ⭐
```

---

## 🔧 实现方法

### Fabric 平台

在 `fabric/build.gradle` 中修改：

```gradle
dependencies {
    // ... 其他依赖 ...
    
    // Architectury API - 内嵌到模组中
    modImplementation("dev.architectury:architectury-fabric:13.0.8") {
        exclude group: "net.fabricmc.fabric-api"
    }
    include("dev.architectury:architectury-fabric:13.0.8")  // 添加这行
    
    // Cloth Config API - 保持外部依赖
    modApi("me.shedaniel.cloth:cloth-config-fabric:15.0.140") {
        exclude group: "net.fabricmc.fabric-api"
    }
}
```

### NeoForge 平台

在 `neoforge/build.gradle` 中修改：

```gradle
dependencies {
    // ... 其他依赖 ...
    
    // Architectury API - 内嵌到模组中
    modImplementation "dev.architectury:architectury-neoforge:13.0.8"
    jarJar(group: "dev.architectury", name: "architectury-neoforge", version: "[13.0.8,14.0.0)")
    
    // Cloth Config API - 保持可选
    modCompileOnly "me.shedaniel.cloth:cloth-config-neoforge:15.0.140"
    modRuntimeOnly "me.shedaniel.cloth:cloth-config-neoforge:15.0.140"
}
```

### 更新 fabric.mod.json

```json
{
  "depends": {
    "fabricloader": ">=0.16.9",
    "minecraft": "~1.21.1",
    "java": ">=21",
    "fabric-api": "*"
    // 移除 "architectury": ">=13.0.0" 这行
  }
}
```

### 更新 neoforge.mods.toml

```toml
# 移除或注释掉 Architectury 依赖
# [[dependencies.roadweaver]]
# modId = "architectury"
# type = "required"
# versionRange = "[13.0,)"
# ordering = "AFTER"
# side = "BOTH"
```

---

## 📊 方案对比表

| 方案 | 减少前置数 | 文件增大 | 维护成本 | 用户体验 | 推荐度 |
|------|-----------|---------|---------|---------|--------|
| 不内嵌 | 0 | 0 | ⭐⭐⭐⭐⭐ | ⭐⭐ | ⭐⭐ |
| 仅 Architectury | Fabric: 1<br>NeoForge: 1 | ~500KB | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| 仅 Cloth Config | Fabric: 1<br>NeoForge: 1 | ~1MB | ⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐ |
| 两者都内嵌 | Fabric: 2<br>NeoForge: 2 | ~1.5MB | ⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ |

---

## ⚠️ 注意事项

### 1. JiJ (Jar-in-Jar) 技术

内嵌依赖使用 JiJ 技术：
- ✅ 不会与玩家手动安装的版本冲突
- ✅ 如果玩家已安装，会优先使用玩家版本
- ✅ 如果玩家未安装，使用内嵌版本

### 2. 版本兼容性

内嵌后需要注意：
- 定期检查 Architectury 更新
- 如果 Architectury 有重大更新，需要重新发布模组
- 在 CHANGELOG 中说明内嵌的依赖版本

### 3. 文件大小

- 当前模组大小: ~200KB
- 内嵌 Architectury 后: ~700KB
- 内嵌两者后: ~1.7MB

对于模组来说，1-2MB 的增加是可以接受的。

### 4. 发布说明

在 Modrinth/CurseForge 的描述中说明：
```
✅ Architectury API 已内嵌，无需单独下载
⚠️ Fabric 玩家仍需下载: Fabric API, Cloth Config, Mod Menu
⚠️ NeoForge 玩家仍需下载: Cloth Config (推荐)
```

---

## 🎯 其他考虑

### 为什么不内嵌 Fabric API？

- ❌ Fabric API 是 Fabric 平台的核心库
- ❌ 几乎所有 Fabric 模组都需要
- ❌ 玩家 100% 已经安装
- ❌ 文件非常大（~5MB）
- ❌ 更新频繁

### 为什么不内嵌 Mod Menu？

- ❌ Mod Menu 是可选依赖
- ❌ 很多玩家已经安装
- ❌ 不是核心功能（可以通过配置文件配置）
- ❌ 内嵌后会强制包含，增加不必要的体积

---

## 📝 实施建议

### 推荐步骤

1. **第一阶段**: 内嵌 Architectury API
   - 修改 build.gradle
   - 测试 Fabric 和 NeoForge
   - 更新文档和说明

2. **观察反馈**: 发布后观察玩家反馈
   - 如果玩家仍然觉得前置太多
   - 考虑在下一版本内嵌 Cloth Config

3. **长期维护**: 定期检查依赖更新
   - 每个大版本检查 Architectury 更新
   - 如有重大更新，重新发布模组

---

## 📊 最终建议

### 🏆 推荐方案：仅内嵌 Architectury API

**理由**:
- ✅ 最佳的性价比（减少 1 个必需前置，仅增加 500KB）
- ✅ 维护成本低（Architectury 更新少）
- ✅ 不会造成过多冗余（Architectury 不如 Cloth Config 常见）
- ✅ 两个平台都受益

**实施后**:
- Fabric: 4 个前置 → 3 个前置
- NeoForge: 2 个前置 → 1 个前置
- 用户体验显著提升

---

**最后更新**: 2025-10-11  
**建议状态**: 待实施
